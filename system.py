import streamlit as st
from pyChatGPT import ChatGPT
from pypdf import PdfReader


def get_result_form_pdf(pdf_file):
    pdf_reader = PdfReader(pdf_file)
    st = ""

    for page in range(len(pdf_reader.pages)):
        text = pdf_reader.pages[page]
        st += text.extract_text()

    temp_ar = 'اكتب اسئلة واجوبتها عن النص الثالي:\n'
    temp_en = 'Write questions and anwers on next text:\n'

    session_token = 'eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0..xVkKAeWFUD_20DLD.ev2JtfQCjZFZlP1m-pbcpBPkz7doH5Xn0On4NSKRJ0IEC5Q-stb2-ZOeYvEXwSLHMhAg-pqdmT2c0X2v2gBkLirCXleH4xKEqkpuqK6KVj9G8cCFu7k3mVU3wymA_XFEQfAR8hDkaoK8ClWJuZtfcuxrSopFwd1jM4-3F9qkTVbd4obclhH0MWZZR04cHjtH6XB90pyE8z1VBXUhQP2pfmuTR98Ge1VI3xHO_4aKkbR4DQIe6cZuOyRe73PghPMjvJ8lue695BYqpAGx_ebmveEDgvDxbzK0HIOmt-iui8Kniw0rpTL3O4micbUgEythzYyPNCqscjo1EMaF3MArwYuMy7wOi5_GlskyxEdN6McA43xI0Z4SEyd34s0AQasv9D_Q8rqkIwio1lXScTUzOMGa-s0jDrCvj_2D71oUSg1xNv1_Civ_gjC-TZO7rmV-19SYIhoCdDZa6mNyesz9OO1ORv21T3p5YfdSGTDWjFbsCpTnX_eWDDdOgu9oT-jyizUFJTK0Ri4rk1zcpd_Pj3iglFBWu4hyOK-qPOkI1kZl_UCM3XZclofHvxwabGkJMCnQwL00l5g0JfgoaXXZGxmF7Sgq_jWJyZKkaMvuAit4k9B6PV4TTmND4BnO3c7GJK0186nqjP3aHnxWxhxBj9Qfc9KN44agUvD2MUirMxv3UD44Qnl_1uHS3VfLSpX_EcqzlpmPcD7qsKX_G3neDSlpe06O1xsTbbx2J-xzTZ0LjkNyPaJRpnVyNre20PmEO1h9zrsa6Jr3NFCrbGz09-7Uup2t1c3R70Qu4WBr6b8hEOnx9RUPZymvXON0T9587tC7LSJf0oq5uTuERXgP_YUQrffq3pgC2qEAO2XHSId7joqt2FB4HGDNj6GmOIWlIV35p_gqRBys19yLETVK4t2aKJa85ECXdbitYIGfj5KhM3QFQix_n9lT9R0-fUaq-BiShJ43ONFsz3Wzj1fK5KLKQ0CxPyc7WrJFKhtAcm-Ym84GqHC_uajEnx405x0EkTAlXoWB_9F7MQ5Kh-PNEUp6nt1Zk2tP7RbGiw7RsF9F-bH4XfV4b08dscbqqmz-neL2khBXBOavTN2dNu_NfJ1iq5NXr3012Zr-sIiESSaDdEmgVAaxDBJxTfwcV3M3pl4j5t1FX2AIRIAZCoMzbvyJuC5I4XGWmyJAgbHxaMWsT1omWQIjtU3_ms3TccDHKHHedT-m6zLBPYFusXXLhmIzc6JUlmvasLH356HLiQev5krTZemZqdEMFr7Y-NMm1tRsHeo7cbwXdbVAIkYFsuH1_5QJtyPNkes0m0UWDLqkvwB6WhQpyRR6g5gZnj-rhrztt7JvsuZ1pwJi_snW3UH9ipyEc7OiDVv49AoYFNSZjnYCXvAOt7zNUDkDN62FK1xwNe_paI5JtBEjyWOjdITzTWT-pnQ-b-yVqWD0ner77v7pDmyFZqzjqo5YF371wFwbBbm273Vw-vsnSGyyQJfkysWqn35RnHqOR96Qgqa6Zzy5JNRAAEAxwMVuln5DmaHKZ9m-QVXUYiLL5vUN5Nq-71BJwRXFBie871QHAPhmMVDtGn8INECsAgMjrUNrlt5Ub21GUpTnc2gvwYDGcU1CYLjyFFB2gCZLW_4XDeJcfxr_BSq48n-9jIvF2omN_GvBlD7SExcWXty08XeZEO-KgZegltCnYxXYbX7ifw9RyeZnL_xYEeV6nbPTYfZbkuip251J8pF3BNjxX2kuHMtkEJi_52g643sPgXeUZ-lCYkW4cSUKlnnPZPb3wwP1gyfQTWZBbeJPL-2MAFUIqhSgVY27Fvd-5HY3-Ex3y-JpD0hXagt87S_QnexLzDOK3uch9QfiPLVbMOcV_pp70v8P5LpgMg6Lfy4s_6ITBd7iggCj7sy94_Zjc4S_VK7pefGZoL96tFvMyGCdM5M8N20GC5cMHbd8TrahczZNfsrBHcRENcXuAmFVFoegTeAIJXTPiqcxreD0xTcipVPQpzYsSQhRPdxF4nQoa5_jjEw-u2rB7qwnpX-YU3bFwJ9sC710KTMh5-3gwE8pic1vbcxbJ0CN3co15j0qYXHTLD5FR5RlW8W1uXk3aaLkICDZGO_7bDFek7UvJ5yHhysVX-R1hCzLNqaOzFd04x26REVy3R6Jl-XTgpgWFGddI9cP47hs-8Jl7ri3s0tAuaO89T9lPpvjbnRQ1-yVQGar0Uad6bwzKHW6osNEqwvO0xtLMwe3-D4-bQkfUAPfLHYXRTc0L9Oinn_mD85PnbFeyIq150kMCLwVBYBvtK9FRRpLBvo_D5hnHR_Gmchp4BD7-jeeTAdXVKAM4NPeRUaM2xSvUGGK0_vAbDCLunOg6L3Net8v9iev9cliaLjbfCLx_DvUOAZqyq6aOvzDmTek4-CLiGHeRWutJ2ZolQanVj1m0BpFM4w_ryczCZqKJLeFRhlx8FDIh2rfVQbx3FbXUe0x3Zq97D8ji7JMVoAnhpAY90R8SmikqS-RVPDvF3dZtkbKftSNWLpYEA6M_D_WytF12yB-pSzLQ_E-qod9ag.BIS2xN-g6JuCoUJrBVo6sw'
    api = ChatGPT(session_token)

    resp = api.send_message(temp_en + st)
    return resp['message']
    

def get_result_form_text(txt):
    temp_ar = 'اكتب اسئلة واجوبتها عن النص الثالي:\n'
    temp_en = 'Write questions and anwers on next text:\n'

    session_token = 'eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0..xVkKAeWFUD_20DLD.ev2JtfQCjZFZlP1m-pbcpBPkz7doH5Xn0On4NSKRJ0IEC5Q-stb2-ZOeYvEXwSLHMhAg-pqdmT2c0X2v2gBkLirCXleH4xKEqkpuqK6KVj9G8cCFu7k3mVU3wymA_XFEQfAR8hDkaoK8ClWJuZtfcuxrSopFwd1jM4-3F9qkTVbd4obclhH0MWZZR04cHjtH6XB90pyE8z1VBXUhQP2pfmuTR98Ge1VI3xHO_4aKkbR4DQIe6cZuOyRe73PghPMjvJ8lue695BYqpAGx_ebmveEDgvDxbzK0HIOmt-iui8Kniw0rpTL3O4micbUgEythzYyPNCqscjo1EMaF3MArwYuMy7wOi5_GlskyxEdN6McA43xI0Z4SEyd34s0AQasv9D_Q8rqkIwio1lXScTUzOMGa-s0jDrCvj_2D71oUSg1xNv1_Civ_gjC-TZO7rmV-19SYIhoCdDZa6mNyesz9OO1ORv21T3p5YfdSGTDWjFbsCpTnX_eWDDdOgu9oT-jyizUFJTK0Ri4rk1zcpd_Pj3iglFBWu4hyOK-qPOkI1kZl_UCM3XZclofHvxwabGkJMCnQwL00l5g0JfgoaXXZGxmF7Sgq_jWJyZKkaMvuAit4k9B6PV4TTmND4BnO3c7GJK0186nqjP3aHnxWxhxBj9Qfc9KN44agUvD2MUirMxv3UD44Qnl_1uHS3VfLSpX_EcqzlpmPcD7qsKX_G3neDSlpe06O1xsTbbx2J-xzTZ0LjkNyPaJRpnVyNre20PmEO1h9zrsa6Jr3NFCrbGz09-7Uup2t1c3R70Qu4WBr6b8hEOnx9RUPZymvXON0T9587tC7LSJf0oq5uTuERXgP_YUQrffq3pgC2qEAO2XHSId7joqt2FB4HGDNj6GmOIWlIV35p_gqRBys19yLETVK4t2aKJa85ECXdbitYIGfj5KhM3QFQix_n9lT9R0-fUaq-BiShJ43ONFsz3Wzj1fK5KLKQ0CxPyc7WrJFKhtAcm-Ym84GqHC_uajEnx405x0EkTAlXoWB_9F7MQ5Kh-PNEUp6nt1Zk2tP7RbGiw7RsF9F-bH4XfV4b08dscbqqmz-neL2khBXBOavTN2dNu_NfJ1iq5NXr3012Zr-sIiESSaDdEmgVAaxDBJxTfwcV3M3pl4j5t1FX2AIRIAZCoMzbvyJuC5I4XGWmyJAgbHxaMWsT1omWQIjtU3_ms3TccDHKHHedT-m6zLBPYFusXXLhmIzc6JUlmvasLH356HLiQev5krTZemZqdEMFr7Y-NMm1tRsHeo7cbwXdbVAIkYFsuH1_5QJtyPNkes0m0UWDLqkvwB6WhQpyRR6g5gZnj-rhrztt7JvsuZ1pwJi_snW3UH9ipyEc7OiDVv49AoYFNSZjnYCXvAOt7zNUDkDN62FK1xwNe_paI5JtBEjyWOjdITzTWT-pnQ-b-yVqWD0ner77v7pDmyFZqzjqo5YF371wFwbBbm273Vw-vsnSGyyQJfkysWqn35RnHqOR96Qgqa6Zzy5JNRAAEAxwMVuln5DmaHKZ9m-QVXUYiLL5vUN5Nq-71BJwRXFBie871QHAPhmMVDtGn8INECsAgMjrUNrlt5Ub21GUpTnc2gvwYDGcU1CYLjyFFB2gCZLW_4XDeJcfxr_BSq48n-9jIvF2omN_GvBlD7SExcWXty08XeZEO-KgZegltCnYxXYbX7ifw9RyeZnL_xYEeV6nbPTYfZbkuip251J8pF3BNjxX2kuHMtkEJi_52g643sPgXeUZ-lCYkW4cSUKlnnPZPb3wwP1gyfQTWZBbeJPL-2MAFUIqhSgVY27Fvd-5HY3-Ex3y-JpD0hXagt87S_QnexLzDOK3uch9QfiPLVbMOcV_pp70v8P5LpgMg6Lfy4s_6ITBd7iggCj7sy94_Zjc4S_VK7pefGZoL96tFvMyGCdM5M8N20GC5cMHbd8TrahczZNfsrBHcRENcXuAmFVFoegTeAIJXTPiqcxreD0xTcipVPQpzYsSQhRPdxF4nQoa5_jjEw-u2rB7qwnpX-YU3bFwJ9sC710KTMh5-3gwE8pic1vbcxbJ0CN3co15j0qYXHTLD5FR5RlW8W1uXk3aaLkICDZGO_7bDFek7UvJ5yHhysVX-R1hCzLNqaOzFd04x26REVy3R6Jl-XTgpgWFGddI9cP47hs-8Jl7ri3s0tAuaO89T9lPpvjbnRQ1-yVQGar0Uad6bwzKHW6osNEqwvO0xtLMwe3-D4-bQkfUAPfLHYXRTc0L9Oinn_mD85PnbFeyIq150kMCLwVBYBvtK9FRRpLBvo_D5hnHR_Gmchp4BD7-jeeTAdXVKAM4NPeRUaM2xSvUGGK0_vAbDCLunOg6L3Net8v9iev9cliaLjbfCLx_DvUOAZqyq6aOvzDmTek4-CLiGHeRWutJ2ZolQanVj1m0BpFM4w_ryczCZqKJLeFRhlx8FDIh2rfVQbx3FbXUe0x3Zq97D8ji7JMVoAnhpAY90R8SmikqS-RVPDvF3dZtkbKftSNWLpYEA6M_D_WytF12yB-pSzLQ_E-qod9ag.BIS2xN-g6JuCoUJrBVo6sw'
    api = ChatGPT(session_token)

    resp = api.send_message(temp_en + txt)
    return resp['message']
    


st.title("Give Me Questions & Answers")
st.header('Upload PDF File:')

st.text_input("Your text", key="textBox")
pdf_file = st.file_uploader("Upload PDF file", type=["pdf"])

if st.button('Submit'):
    if pdf_file is not None:
        final_ans = get_result_form_pdf(pdf_file)
        st.success(final_ans)
    elif (st.session_state.textBox != ""):
        final_ans = get_result_form_text(st.session_state.textBox)
        st.success(final_ans)
    else:
        st.success('PLease upload pdf file!')